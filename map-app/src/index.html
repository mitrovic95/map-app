<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>MapApp</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js"></script>
<body>
  <style>
    body {
    overflow: hidden;
    }
     
    body * {
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    }
     
    .map {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 220px;
    width: calc(100% - 220px);
    }

    .mapboxgl-compare {
      left: 220px;
    }
    </style>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-compare/v0.4.0/mapbox-gl-compare.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-compare/v0.4.0/mapbox-gl-compare.css" type="text/css">
    <app-root></app-root>
    <div id="comparison-container">
      <div id="before" class="map"></div>
      <div id="after" class="map">
        <pre id="coordinates" class="coordinates"></pre>
      </div>
    </div>
  <script>
    var coordinates = document.getElementById('coordinates');

    mapboxgl.accessToken = 'pk.eyJ1IjoibWl0cm92aWM5NSIsImEiOiJja2xjd29oY3cwYmo4Mm9uMXRlOHA1emJrIn0.oxW6V9Li351rht2oN-ZdAw';
    var beforeMap = new mapboxgl.Map({
      container: 'before',
      style: 'mapbox://styles/mapbox/streets-v11',
      center: [19.75316247558669, 45.25840059970221],
      zoom: 11
    });
 
    var afterMap = new mapboxgl.Map({
      container: 'after',
      style: 'https://api.maptiler.com/maps/eef16200-c4cc-4285-9370-c71ca24bb42d/style.json?key=CH1cYDfxBV9ZBu1lHGqh',
      center: [19.75316247558669, 45.25840059970221],
      zoom: 11
    });
    
    this.afterMap.addControl(new mapboxgl.NavigationControl());

    // A selector or reference to HTML element
    var container = '#comparison-container';
    
    var dd = new mapboxgl.Compare(beforeMap, afterMap, container, {
    // Set this to enable comparing two maps by mouse movement:
    // mousemove: true
    //mousemove: true, // Optional. Set to true to enable swiping during cursor movement.
    orientation: 'vertical'
    });

    var data = {
      "zoom": 11,
      "type":"FeatureCollection",
      "query":[
         "zeleznicka",
         "7",
         "novi",
         "sad"
      ],
      "features":[
         {
            "id":"address.3367459281327316",
            "type":"Feature",
            "place_type":[
               "address"
            ],
            "relevance":1,
            "properties":{
               "accuracy":"rooftop"
            },
            "text":"Железничка",
            "place_name":"Железничка 7, Novi Sad 21208, South Bačka, Serbia",
            "matching_text":"Zeleznicka",
            "matching_place_name":"Zeleznicka 7, Novi Sad 21208, South Bačka, Serbia",
            "center":[
               19.844865,
               45.22281
            ],
            "geometry":{
               "type":"Point",
               "coordinates":[
                  19.844865,
                  45.22281
               ]
            },
            "address":"7",
            "context":[
               {
                  "id":"postcode.15632382623744550",
                  "text":"21208"
               },
               {
                  "id":"place.6270780346322390",
                  "wikidata":"Q55630",
                  "text":"Novi Sad"
               },
               {
                  "id":"region.10868041610429420",
                  "wikidata":"Q648718",
                  "short_code":"RS-06",
                  "text":"South Bačka"
               },
               {
                  "id":"country.8604936944096850",
                  "wikidata":"Q403",
                  "short_code":"rs",
                  "text":"Serbia"
               }
            ]
         },
         {
            "id":"address.2103453683729526",
            "type":"Feature",
            "place_type":[
               "address"
            ],
            "relevance":1,
            "properties":{
               "accuracy":"rooftop"
            },
            "text":"Железничка",
            "place_name":"Железничка 7, Novi Sad 21101, South Bačka, Serbia",
            "matching_text":"Zeleznicka",
            "matching_place_name":"Zeleznicka 7, Novi Sad 21101, South Bačka, Serbia",
            "center":[
               19.841964,
               45.251023
            ],
            "geometry":{
               "type":"Point",
               "coordinates":[
                  19.841964,
                  45.251023
               ]
            },
            "address":"7",
            "context":[
               {
                  "id":"postcode.8201119075568480",
                  "text":"21101"
               },
               {
                  "id":"place.6270780346322390",
                  "wikidata":"Q55630",
                  "text":"Novi Sad"
               },
               {
                  "id":"region.10868041610429420",
                  "wikidata":"Q648718",
                  "short_code":"RS-06",
                  "text":"South Bačka"
               },
               {
                  "id":"country.8604936944096850",
                  "wikidata":"Q403",
                  "short_code":"rs",
                  "text":"Serbia"
               }
            ]
         },
         {
            "id":"address.4348909375389006",
            "type":"Feature",
            "place_type":[
               "address"
            ],
            "relevance":1,
            "properties":{
               "accuracy":"rooftop"
            },
            "text":"Железничка",
            "place_name":"Железничка 7, Novi Sad 21203, South Bačka, Serbia",
            "matching_text":"Zeleznicka",
            "matching_place_name":"Zeleznicka 7, Novi Sad 21203, South Bačka, Serbia",
            "center":[
               19.751347,
               45.256286
            ],
            "geometry":{
               "type":"Point",
               "coordinates":[
                  19.751347,
                  45.256286
               ]
            },
            "address":"7",
            "context":[
               {
                  "id":"postcode.12354992381345780",
                  "text":"21203"
               },
               {
                  "id":"place.6270780346322390",
                  "wikidata":"Q55630",
                  "text":"Novi Sad"
               },
               {
                  "id":"region.10868041610429420",
                  "wikidata":"Q648718",
                  "short_code":"RS-06",
                  "text":"South Bačka"
               },
               {
                  "id":"country.8604936944096850",
                  "wikidata":"Q403",
                  "short_code":"rs",
                  "text":"Serbia"
               }
            ]
         },
         {
            "id":"address.8030323803368970",
            "type":"Feature",
            "place_type":[
               "address"
            ],
            "relevance":0.703704,
            "properties":{
               "accuracy":"street"
            },
            "text":"Железничка",
            "place_name":"Железничка 2, Novi Sad 21410, South Bačka, Serbia",
            "matching_text":"Zeleznicka",
            "matching_place_name":"Zeleznicka 2, Novi Sad 21410, South Bačka, Serbia",
            "center":[
               19.7018405,
               45.2472491
            ],
            "geometry":{
               "type":"Point",
               "coordinates":[
                  19.7018405,
                  45.2472491
               ]
            },
            "context":[
               {
                  "id":"postcode.9852661472321810",
                  "text":"21410"
               },
               {
                  "id":"place.6270780346322390",
                  "wikidata":"Q55630",
                  "text":"Novi Sad"
               },
               {
                  "id":"region.10868041610429420",
                  "wikidata":"Q648718",
                  "short_code":"RS-06",
                  "text":"South Bačka"
               },
               {
                  "id":"country.8604936944096850",
                  "wikidata":"Q403",
                  "short_code":"rs",
                  "text":"Serbia"
               }
            ]
         },
         {
            "id":"address.756290778194592",
            "type":"Feature",
            "place_type":[
               "address"
            ],
            "relevance":0.688889,
            "properties":{
               "accuracy":"street"
            },
            "text":"Alekse Gavrilovica",
            "place_name":"Alekse Gavrilovica 2, Novi Sad 21211, South Bačka, Serbia",
            "matching_text":"Alekse Gavrilovica",
            "matching_place_name":"Alekse Gavrilovica 2, Novi Sad 21211, South Bačka, Serbia",
            "center":[
               19.7330968,
               45.3587441
            ],
            "geometry":{
               "type":"Point",
               "coordinates":[
                  19.8420830,
                  45.2787441
               ]
            },
            "context":[
               {
                  "id":"postcode.8335192100972840",
                  "text":"21211"
               },
               {
                  "id":"place.6270780346322390",
                  "wikidata":"Q55630",
                  "text":"Novi Sad"
               },
               {
                  "id":"region.10868041610429420",
                  "wikidata":"Q648718",
                  "short_code":"RS-06",
                  "text":"South Bačka"
               },
               {
                  "id":"country.8604936944096850",
                  "wikidata":"Q403",
                  "short_code":"rs",
                  "text":"Serbia"
               }
            ]
         }
      ],
      "attribution":"NOTICE: © 2021 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained. POI(s) provided by Foursquare."
   };
   let mapTest = this.afterMap;
   var canvas = this.afterMap.getCanvasContainer();
  
   data.features.forEach((marker, i) => {
     
    var el = document.createElement('div');
    el.className = 'marker';
    // const zoomInButton = document.createElement('button');
    // zoomInButton.classList.add('radi');
    // zoomInButton.addEventListener('click', () => {
    //   alert("Clicked");
    // });
    

    var newMarker = new mapboxgl.Marker(el, {draggable: true})
      .setLngLat([marker.geometry.coordinates[0], marker.geometry.coordinates[1]])
      .setPopup(new mapboxgl.Popup({ offset: 25, closeOnClick: true,
        anchor: 'bottom', })
      .setHTML('<h3>' + marker.text + '</h3><p>' + marker.place_name + `</p><button class="zoom-in">zoom in</button><button class="zoom-out">zoom out</button>`))
      .addTo(mapTest);
      
      el.addEventListener(('click'), (e) => {
        setTimeout(() => {
          (document.querySelector('.zoom-in'))?.addEventListener(('click'), () => {
            mapTest.flyTo({center: [marker.geometry.coordinates[0], marker.geometry.coordinates[1]], zoom: data.zoom += 1 });
          });
          (document.querySelector('.zoom-out'))?.addEventListener(('click'), () => {
            mapTest.flyTo({center: [marker.geometry.coordinates[0], marker.geometry.coordinates[1]], zoom: data.zoom -= 1 });
          });
        }, 300);
      });

      // el.addEventListener(('click'), () => {
      //   setTimeout(() => {
      //     (document.querySelector('.zoom-out') as HTMLElement)?.addEventListener(('click'), () => {
      //       debugger
      //       mapTest.flyTo({center: [marker.geometry.coordinates[0], marker.geometry.coordinates[1]], zoom: this.zoom-- });
  
      //     });
      //   }, 300);
      // });
      //  newMarker.getPopup().setHTML(`zoomInButton`);
      // console.log("🚀 ~ file: map.service.ts ~ line 316 ~ MapService ~ newMarker.getElement ~ newMarker.getElement()", newMarker.getElement().querySelector('button.zoom-in'))
      // newMarker.getElement().addEventListener('click', () => {
      //   alert("Clicked");
      // });

      function onDragEnd() {
      var lngLat = newMarker.getLngLat();
      console.log("🚀 ~ file: map.service.ts ~ line 316 ~ MapService ~ onDragEnd ~ lngLat", lngLat)
      // TO DO napisi da ovde moze post metoda da ide
      coordinates.style.display = 'block';
      coordinates.innerHTML =
      'Longitude: ' + lngLat.lng + '<br />Latitude: ' + lngLat.lat;
      }
       
      newMarker.on('dragend', onDragEnd);

      // var test = this.zoom;
      // setTimeout(() => {
      //   let zoomInButton = document.getElementById("zoom-in-0");
      //   debugger
      //   zoomInButton!.addEventListener("click", handleClick);
      // }, 1000)

      // function handleClick() {
      //     debugger
      //     setTimeout(() => {
      //       // mapTest.setCenter(newMarker.getLngLat());
      //       // mapTest.setZoom(test + 1);
      //       // removeEventListener("click", handleClick);
      //     }, 2000)
      // }
      // function zoomInMarker() {
      //   newMarker.on('dobleclick', function(e){
      //     debugger
      //     mapTest.setCenter(newMarker.getLngLat());
      //     mapTest.setZoom(test + 1);
      // });

      // document.addEventListener((click) => {

      // });
      // console.log("🚀 ~ file: map.service.ts ~ line 327 ~ MapService ~ data.features.forEach ~ test", test)
      // }

    })
  </script>
</body>
</html>
